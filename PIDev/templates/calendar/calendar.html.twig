{% extends 'baseF.html.twig' %}

{% block body %}
    <h1>Emplois du temps</h1>

    <link href="path/to/bootstrap.min.css" rel="stylesheet">
    <link href="path/to/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.3.0/main.min.css" integrity="sha256-uq9PNlMzB+1h01Ij9cx7zeE2OR2pLAfRw3uUUOOPKdA=" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.3.0/main.min.js" integrity="sha256-DBxkGZLxKsLKhz054qUpBqtotG00r9AELGpSigJujLg=" crossorigin="anonymous"></script>
    <div id="calendrier"></div>

{% block javascripts %}
<script>

        document.addEventListener('DOMContentLoaded', function () {
            let calendarElt = document.querySelector("#calendrier");
            let calendar = new FullCalendar.Calendar(calendarElt, {
                
                allDaySlot: false,
                initialView: 'dayGridMonth',
                locale: 'fr',  
                timeZone: 'Africa/Tunis',
                headerToolbar: {
                    left: 'prev,next today',    
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'

                },
                events: {{ data|raw }},
                 eventContent: function(info) {
                return {
                    html: `<div class="fc-content">${info.event.extendedProps.titre}</div>
                           <div class="fc-description">${info.event.extendedProps.description}</div>
                           <div class="fc-description">
                            <button class="btn btn-danger btn-sm delete-event" data-event-id="${info.event.id}">
                                <i class="bi bi-trash"></i> Delete
                            </button>
                       </div>`
                    };
                        },
                        editable:true,
                        eventResizableFromStart: true,

                
            })
            ///editEmploi/{id}/edit
            calendar.on('eventChange',(e) => {

                let url = `/editEmploi/${e.event.id}/edit`;
                 let donnees = {

                "titre": e.event.extendedProps.titre,
                "start": e.event.start,
                "end": e.event.end,
                "description": e.event.extendedProps.description,
                 }
                 console.log(donnees)
            let xhr = new XMLHttpRequest

            xhr.open("PUT", url)
            xhr.send(JSON.stringify(donnees))

                
            })
             calendarElt.addEventListener('click', function (event) {
        if (event.target.classList.contains('delete-event')) {
            let eventId = event.target.getAttribute('data-event-id');

            // Confirm deletion
            if (confirm("Are you sure you want to delete this event?")) {
                // Delete the event from the calendar
                calendar.getEventById(eventId).remove();

                // Send a request to delete the event on the server
                fetch(`/deleteEmploi/${eventId}`, {
                    method: 'DELETE',
                }).then(response => {
                    if (response.ok) {
                        // Event deleted successfully
                        console.log('Event deleted successfully');
                    } else {
                        // Handle error
                        console.error('Failed to delete event');
                    }
                });
            }
        }
    });

            calendar.render();
        });
    </script>
    <!-- Your existing script and style links... -->
{% endblock %}

{% block stylesheets %}
    <style>
        #calendrier {
            width: 80%; /* Adjust the width to your preference */
            margin: auto;
        }

        #calendrier .fc-header-toolbar .fc-button {
            background-color: #007bff;
            color: #fff;
            border-color: #007bff;
        }

        #calendrier .fc-header-toolbar .fc-button:hover {
            background-color: #0056b3;
            color: #fff;
            border-color: #0056b3;
        }

        #calendrier .fc-content {
            font-size: 1em;
            font-weight: bold;
        }

        #calendrier .fc-description {
            font-size: 0.8em; /* Adjust the font size for event descriptions */
            color: #fff; /* Optionally, set a color for event descriptions */
        }
    </style>
{% endblock %}
{% block javascript %}
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
    {% for flashMessage in app.flashes('success') %}
        <script>
            Swal.fire({
                icon: 'success',
                title: 'Ajouter!',
                text: '{{ flashMessage }} 👍',
                showConfirmButton: true,
                confirmButtonText: 'Great! 😊',
            }).then((result) => {
                if (result.isConfirmed) {
                    window.location.href = '{{ path('app_afficherRendezVous') }}';
                }
            });
        </script>
    {% endfor %}

    {% for flashMessage in app.flashes('error') %}
        <script>
            Swal.fire({
                icon: 'error',
                title: 'Error!',
                text: '{{ flashMessage }} 😞',
                showConfirmButton: true,
                confirmButtonText: 'OK! 👌',
            });
        </script>
    {% endfor %}
    {% endblock %}

    
{% endblock %}
